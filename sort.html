<html>
<head>
	<title>Sort</title>
</head>
<body>
	<script src="d3.min.js"></script>
	<script src="jquery.min.js"></script>

	<button onclick="sort();">Sort</button>

	<script type="text/javascript">
	    
	    var width = 960,
    		height = 500;
    	var padding = 40;
    	var speed = 50;

		var nodes = d3.range(125).map(function(i) { return {
			radius: Math.random() * 20 + 1, 
			index: i, 
			x: padding + (i % 20 * padding), 
			y: padding + Math.floor(i / 20) * padding 
		}; });
		
		var color = d3.scale.category10();

		console.log(nodes);

		var svg = d3.select("body").append("svg")
		    .attr("width", width)
		    .attr("height", height);

	    var circles = svg.selectAll("circle")
			.data(nodes)
			.enter().append("circle")
		    .attr("r", function(d) { return d.radius; })
		    .attr("id", function(d) { return "circle" + d.index; })
		    .attr("cx", function(d) { return d.x; } )
		    .attr("cy", function(d) { return d.y; } )
		    .style("fill", function(d, j) { return color(j % 2); });

	    //var circle = d3.select("#circle10");
	    // circle
		   //  .transition()
		   //  .duration(750)
		   //  .attr("cy", 100)
		   //  .attr("cx", 100);


	    function swap(nodes, index, delay){
	    	
	    	var node1 = nodes[index];
	    	var node2 = nodes[index + 1];

	    	nodes[index + 1] = node1;
	    	nodes[index] = node2;

	    	//console.log(nodes.map(function(node){ return node.radius }));
	    	console.log('swap', index, index + 1);

	    	var circle1 = d3.select("#circle" + node1.index);
	    	var circle2 = d3.select("#circle" + node2.index);

	    	var c1x = node1.x;
	    	var c1y = node1.y;
	    	var c2x = node2.x;
	    	var c2y = node2.y;

	    	node1.x = c2x;
	    	node1.y = c2y;
	    	node2.x = c1x;
	    	node2.y = c1y;

	    	console.log('move circle 1');
	    	circle1
		    .transition()		    
		    .duration(speed)
		    .attr("cx", c2x)
		    .attr("cy", c2y);

		    console.log('move circle 2');
		    circle2
		    .transition()		    
		    .duration(speed)
		    .attr("cx", c1x)
		    .attr("cy", c1y);

		    console.log('swap done');	    	
	    }

	    function sortStep(){		    
		    for(var i=0;i<nodes.length - 1;i++)
		    	for(var j=0;j<nodes.length - i - 1;j++){
	    			var node1 = nodes[j];
	    			var node2 = nodes[j+1];
	    			if(node1.radius < node2.radius){	    				
	    				swap(nodes, j);   
	    				return true;		
	    			}
		    	}
	    	return false;
	    }

	    function sort(){	    	
	    	if(sortStep())
	    		setTimeout(sort, speed);
	    }


	</script>
</body>
</html>